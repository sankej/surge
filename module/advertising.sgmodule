#!name=去广告
#!desc=去广告 by SankeJ

[Rule]
# yjqiang (https://github.com/yjqiang/surge_scripts/tree/main)
# > BiliBili 去广告
// defaultword 搜索框默认填充；square 热搜
// URL-REGEX,https://app.bilibili.com/x/v2/search/(defaultword|square),REJECT
// 搭配 protobuf 的（否则抓不到。。。）
// REJECT-NO-DROP 表示不使用默认的自动丢包逻辑，这样 Surge 每次都会返回 ICMP Port Unreachable，应用会立刻回退而不是等超时。
DOMAIN-SUFFIX, grpc.biliapi.net, REJECT-NO-DROP

# > 爱奇艺视频暂停广告
DOMAIN-SUFFIX, cupid.iqiyi.com, REJECT

# > 知乎屏蔽网页非得让用户登陆的 sb 玩意儿
# https://www.v2ex.com/t/730727
# eg: https://static.zhihu.com/heifetz/main.signflow.8981b23e28b3de684698.js
# https://www.v2ex.com/t/784612
# eg: https://static.zhihu.com/heifetz/column.signflow.288f3addd8e584a7bca6.js
URL-REGEX, ^https://static\.zhihu\.com/[^/]+/(main|column)\.signflow\.[^.]+.js, REJECT

# > Hupu 去广告
// 开屏 和 下拉刷新时的广告
URL-REGEX,^https://goblin\.hupu\.com/[^/]+/[^/]+/interfaceAd/, REJECT

[Script]
# blackmatrix7 (https://github.com/blackmatrix7/ios_rule_script)
# > 开屏去广告
嘀嗒出行_开屏去广告 = type=http-response,requires-body=1,max-size=0,pattern=^https?:\/\/capis(-?\w*)?\.didapinche\.com\/ad\/cx\/startup\?,script-path=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/startup/startup.js
Fa米家_开屏去广告 = type=http-response,requires-body=1,max-size=0,pattern=^https?:\/\/fmapp\.chinafamilymart\.com\.cn\/api\/app\/market\/start\/ad,script-path=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/famijia/famijia_checkin.js
美团外卖_开屏去广告 = type=http-response,requires-body=1,max-size=0,pattern=^https?:\/\/wmapi\.meituan\.com\/api\/v\d+\/loadInfo?,script-path=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/startup/startup.js
小爱音箱_开屏去广告 = type=http-response,requires-body=1,max-size=0,pattern=^https?:\/\/hd\.mina\.mi\.com\/splashscreen\/alert,script-path=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/startup/startup.js
京东_开屏去广告 = type=http-response,requires-body=1,max-size=0,pattern=^https?:\/\/api\.m\.jd\.com\/client\.action\?functionId=start,script-path=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/startup/startup.js
联享家_开屏去广告 = type=http-response,requires-body=1,max-size=0,pattern=^https?:\/\/mi\.gdt\.qq\.com\/gdt_mview.fcg,script-path=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/startup/startup.js

# yjqiang (https://github.com/yjqiang/surge_scripts/tree/main)
# > BiliBili 去广告
// 整体栏的布局修改(包括“首页”右上角、下边 tab 等)
// http-response ^https://app\.bilibili\.com/x/resource/show/tab(/v2)?\?access_key requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/bilibili/bilibili_tab.js
// “首页”的推荐 https://app.bilibili.com/x/v2/feed/index?
// 短视频的推荐 https://app.bilibili.com/x/v2/feed/index/story?
// http-response ^https://app\.bilibili\.com/x/v2/feed/index(/story)?\?access_key requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/bilibili/bilibili_feed.js
// “我的”的修改
// http-response ^https://app\.bilibili\.com/x/v2/account/mine\?access_key requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/bilibili/bilibili_mine.js
// http-response ^https://api\.bilibili\.com/x/v2/reply/main 在 app 改为了 https://app.bilibili.com/bilibili.main.community.reply.v1.Reply/MainList 评论区
// 动态广告
// http-response ^https://app\.bilibili\.com/bilibili\.app\.dynamic\.v2\.Dynamic/DynAll$ requires-body=1,binary-body-mode=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/bilibili/bilibili_dynamic.js
// 播放器广告
// http-response ^https://app\.bilibili\.com/bilibili\.app\.view\.v1\.View/View$ requires-body=1,binary-body-mode=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/bilibili/bilibili_view.js
// 开屏广告（预加载）
// https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/script/bilibili/bilibili_plus.js
// http-response ^https://app\.bilibili\.com/x/v2/splash/list requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/bilibili/bilibili_splash.js

# > Weixin 去广告
// 公众号文章底部广告 https://mp.weixin.qq.com/mp/getappmsgad?f=json&
http-response ^https://mp\.weixin\.qq\.com/mp/getappmsgad\? requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/wechat/wechat_public_accounts.js

# > Weibo 去广告
// 微博下面的评论
http-response ^https://(api\.weibo\.cn|mapi\.weibo\.com)/2/comments/build_comments\? requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/weibo/weibo_comment.js
// 微博 推荐 热门/榜单/放映厅… https://api.weibo.cn/2/statuses/unread_hot_timeline?
// 微博 最新微博 https://api.weibo.cn/2/statuses/friends/timeline?
// 视频流（短视频上划，微博继续推荐新视频） https://api.weibo.cn/2/video/tiny_stream_video_list?
// 微博 全部关注 https://api.weibo.cn/2/statuses/unread_friends_timeline?
http-response ^https://(api\.weibo\.cn|mapi\.weibo\.com)/2/(statuses/unread_hot_timeline|statuses/friends/timeline|video/tiny_stream_video_list|statuses/unread_friends_timeline)\? requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/weibo/weibo_statuses.js
// 发现 搜索 https://api.weibo.cn/2/searchall?
// 超话 帖子/精华/官方 https://api.weibo.cn/2/page?
http-response ^https://(api\.weibo\.cn|mapi\.weibo\.com)/2/(searchall|page)\? requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/weibo/weibo_cardlist.js
// 发现 热点（这货特殊，有卡片广告） https://api.weibo.cn/2/cardlist?
http-response ^https://(api\.weibo\.cn|mapi\.weibo\.com)/2/cardlist\? requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/weibo/weibo_cardlist_discover.js
// 每条微博下面 创作者广告共享计划
http-response ^https://(api\.weibo\.cn|mapi\.weibo\.com)/2/statuses/extend\? requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/weibo/weibo_statuses_extend.js
// 开屏广告
http-response ^https://sdkapp\.uve\.weibo\.com/interface/sdk/sdkad\.php$ requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/weibo/weibo_sdkad.js

[MITM]
hostname = %APPEND% capis.didapinche.com, capis*.didapinche.com, fmapp.chinafamilymart.com.cn, app.bilibili.com, wmapi.meituan.com, hd.mina.mi.com, api.m.jd.com, mi.gdt.qq.com, goblin.hupu.com, mp.weixin.qq.com, api.weibo.cn, mapi.weibo.com, sdkapp.uve.weibo.com, static.zhihu.com